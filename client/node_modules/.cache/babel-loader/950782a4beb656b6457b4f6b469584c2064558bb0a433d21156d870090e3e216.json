{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef } from \"react\";\nimport { FaceMesh } from \"@mediapipe/face_mesh\";\nexport default function PostureAnalyzer({\n  videoRef,\n  onScoreUpdate\n}) {\n  _s();\n  const lastScoreRef = useRef(0);\n  const blinkCountRef = useRef(0);\n  const lastEARRef = useRef(0);\n  useEffect(() => {\n    if (!videoRef.current) return;\n    const faceMesh = new FaceMesh({\n      locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`\n    });\n    faceMesh.setOptions({\n      maxNumFaces: 1,\n      refineLandmarks: true,\n      minDetectionConfidence: 0.7,\n      minTrackingConfidence: 0.7\n    });\n    faceMesh.onResults(results => {\n      if (!results.multiFaceLandmarks) return;\n      const landmarks = results.multiFaceLandmarks[0];\n      const leftEyeOuter = landmarks[33];\n      const rightEyeOuter = landmarks[263];\n      const noseTip = landmarks[1];\n      const faceLeft = landmarks[234];\n      const faceRight = landmarks[454];\n      const leftIris = landmarks[468];\n      const rightIris = landmarks[473];\n\n      // -----------------------------\n      // 1️⃣ Head Yaw (Turning)\n      // -----------------------------\n      const faceWidth = faceRight.x - faceLeft.x;\n      const faceCenterX = (faceLeft.x + faceRight.x) / 2;\n      const yawOffset = Math.abs(noseTip.x - faceCenterX);\n      const yawScore = 1 - Math.min(yawOffset / (faceWidth * 0.3), 1);\n\n      // -----------------------------\n      // 2️⃣ Eye Contact (Iris Centering)\n      // -----------------------------\n      const leftEyeWidth = Math.abs(landmarks[33].x - landmarks[133].x);\n      const leftIrisOffset = Math.abs(leftIris.x - leftEyeOuter.x);\n      const gazeScore = 1 - Math.min(leftIrisOffset / leftEyeWidth, 1);\n\n      // -----------------------------\n      // 3️⃣ Blink Detection (EAR)\n      // -----------------------------\n      const leftEAR = Math.abs(landmarks[159].y - landmarks[145].y) / Math.abs(landmarks[33].x - landmarks[133].x);\n      if (lastEARRef.current !== 0 && leftEAR < lastEARRef.current * 0.5) {\n        blinkCountRef.current++;\n      }\n      lastEARRef.current = leftEAR;\n      const blinkScore = blinkCountRef.current < 20 ? 1 : 0.7;\n\n      // -----------------------------\n      // 4️⃣ Head Tilt\n      // -----------------------------\n      const tilt = Math.abs(leftEyeOuter.y - rightEyeOuter.y);\n      const tiltScore = 1 - Math.min(tilt * 5, 1);\n\n      // -----------------------------\n      // 5️⃣ Stability\n      // -----------------------------\n      const movement = Math.abs(noseTip.x - faceCenterX);\n      const stabilityScore = 1 - Math.min(movement * 3, 1);\n\n      // -----------------------------\n      // FINAL CONFIDENCE\n      // -----------------------------\n      let rawScore = gazeScore * 0.35 + yawScore * 0.2 + tiltScore * 0.15 + blinkScore * 0.15 + stabilityScore * 0.15;\n\n      // Smooth score\n      const smoothed = lastScoreRef.current * 0.8 + rawScore * 0.2;\n      lastScoreRef.current = smoothed;\n      onScoreUpdate(smoothed);\n    });\n    async function analyzeFrame() {\n      if (videoRef.current) {\n        await faceMesh.send({\n          image: videoRef.current\n        });\n      }\n      requestAnimationFrame(analyzeFrame);\n    }\n    analyzeFrame();\n  }, [videoRef, onScoreUpdate]);\n  return null;\n}\n_s(PostureAnalyzer, \"kYBgrlaGst86Mku3DJbiIS5oSU4=\");\n_c = PostureAnalyzer;\nvar _c;\n$RefreshReg$(_c, \"PostureAnalyzer\");","map":{"version":3,"names":["useEffect","useRef","FaceMesh","PostureAnalyzer","videoRef","onScoreUpdate","_s","lastScoreRef","blinkCountRef","lastEARRef","current","faceMesh","locateFile","file","setOptions","maxNumFaces","refineLandmarks","minDetectionConfidence","minTrackingConfidence","onResults","results","multiFaceLandmarks","landmarks","leftEyeOuter","rightEyeOuter","noseTip","faceLeft","faceRight","leftIris","rightIris","faceWidth","x","faceCenterX","yawOffset","Math","abs","yawScore","min","leftEyeWidth","leftIrisOffset","gazeScore","leftEAR","y","blinkScore","tilt","tiltScore","movement","stabilityScore","rawScore","smoothed","analyzeFrame","send","image","requestAnimationFrame","_c","$RefreshReg$"],"sources":["/Users/siva/Desktop/AI-INTERVIEW/client/src/components/PostureAnalyzer.jsx"],"sourcesContent":["import { useEffect, useRef } from \"react\";\nimport { FaceMesh } from \"@mediapipe/face_mesh\";\n\nexport default function PostureAnalyzer({ videoRef, onScoreUpdate }) {\n  const lastScoreRef = useRef(0);\n  const blinkCountRef = useRef(0);\n  const lastEARRef = useRef(0);\n\n  useEffect(() => {\n    if (!videoRef.current) return;\n\n    const faceMesh = new FaceMesh({\n      locateFile: (file) =>\n        `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`,\n    });\n\n    faceMesh.setOptions({\n      maxNumFaces: 1,\n      refineLandmarks: true,\n      minDetectionConfidence: 0.7,\n      minTrackingConfidence: 0.7,\n    });\n\n    faceMesh.onResults((results) => {\n      if (!results.multiFaceLandmarks) return;\n\n      const landmarks = results.multiFaceLandmarks[0];\n\n      const leftEyeOuter = landmarks[33];\n      const rightEyeOuter = landmarks[263];\n      const noseTip = landmarks[1];\n\n      const faceLeft = landmarks[234];\n      const faceRight = landmarks[454];\n\n      const leftIris = landmarks[468];\n      const rightIris = landmarks[473];\n\n      // -----------------------------\n      // 1️⃣ Head Yaw (Turning)\n      // -----------------------------\n      const faceWidth = faceRight.x - faceLeft.x;\n      const faceCenterX = (faceLeft.x + faceRight.x) / 2;\n      const yawOffset = Math.abs(noseTip.x - faceCenterX);\n      const yawScore = 1 - Math.min(yawOffset / (faceWidth * 0.3), 1);\n\n      // -----------------------------\n      // 2️⃣ Eye Contact (Iris Centering)\n      // -----------------------------\n      const leftEyeWidth = Math.abs(landmarks[33].x - landmarks[133].x);\n      const leftIrisOffset = Math.abs(leftIris.x - leftEyeOuter.x);\n\n      const gazeScore = 1 - Math.min(leftIrisOffset / leftEyeWidth, 1);\n\n      // -----------------------------\n      // 3️⃣ Blink Detection (EAR)\n      // -----------------------------\n      const leftEAR =\n        Math.abs(landmarks[159].y - landmarks[145].y) /\n        Math.abs(landmarks[33].x - landmarks[133].x);\n\n      if (lastEARRef.current !== 0 && leftEAR < lastEARRef.current * 0.5) {\n        blinkCountRef.current++;\n      }\n\n      lastEARRef.current = leftEAR;\n\n      const blinkScore =\n        blinkCountRef.current < 20 ? 1 : 0.7;\n\n      // -----------------------------\n      // 4️⃣ Head Tilt\n      // -----------------------------\n      const tilt = Math.abs(leftEyeOuter.y - rightEyeOuter.y);\n      const tiltScore = 1 - Math.min(tilt * 5, 1);\n\n      // -----------------------------\n      // 5️⃣ Stability\n      // -----------------------------\n      const movement =\n        Math.abs(noseTip.x - faceCenterX);\n\n      const stabilityScore =\n        1 - Math.min(movement * 3, 1);\n\n      // -----------------------------\n      // FINAL CONFIDENCE\n      // -----------------------------\n      let rawScore =\n        gazeScore * 0.35 +\n        yawScore * 0.2 +\n        tiltScore * 0.15 +\n        blinkScore * 0.15 +\n        stabilityScore * 0.15;\n\n      // Smooth score\n      const smoothed =\n        lastScoreRef.current * 0.8 +\n        rawScore * 0.2;\n\n      lastScoreRef.current = smoothed;\n\n      onScoreUpdate(smoothed);\n    });\n\n    async function analyzeFrame() {\n      if (videoRef.current) {\n        await faceMesh.send({ image: videoRef.current });\n      }\n      requestAnimationFrame(analyzeFrame);\n    }\n\n    analyzeFrame();\n  }, [videoRef, onScoreUpdate]);\n\n  return null;\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}