{"ast":null,"code":"var _s = $RefreshSig$();\n// client/src/components/PostureAnalyzer.jsx\n\nimport React, { useEffect, useRef } from \"react\";\nexport default function PostureAnalyzer({\n  videoRef,\n  onScoreUpdate\n}) {\n  _s();\n  const faceMeshRef = useRef(null);\n  const intervalRef = useRef(null);\n  const faceFrames = useRef(0);\n  const totalFrames = useRef(0);\n  const headMovement = useRef(0);\n  const lastNose = useRef(null);\n  useEffect(() => {\n    if (!(videoRef !== null && videoRef !== void 0 && videoRef.current)) return;\n    async function init() {\n      if (!window.FaceMesh) {\n        const script = document.createElement(\"script\");\n        script.src = \"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js\";\n        script.async = true;\n        document.body.appendChild(script);\n        await new Promise(resolve => script.onload = resolve);\n      }\n\n      // ⭐ FORCE NON-SIMD WASM (fix crash)\n      window.Module = {\n        wasmBinaryFile: \"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh_solution_wasm_bin.wasm\"\n      };\n      const faceMesh = new window.FaceMesh({\n        locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`\n      });\n      faceMesh.setOptions({\n        maxNumFaces: 1,\n        refineLandmarks: true,\n        minDetectionConfidence: 0.5,\n        minTrackingConfidence: 0.5\n      });\n      faceMesh.onResults(results => {\n        totalFrames.current++;\n        if (results.multiFaceLandmarks) {\n          faceFrames.current++;\n          const landmarks = results.multiFaceLandmarks[0];\n          const leftEye = landmarks[33];\n          const rightEye = landmarks[263];\n          const nose = landmarks[1];\n          const eyeCenterX = (leftEye.x + rightEye.x) / 2;\n          const gazeOffset = Math.abs(nose.x - eyeCenterX);\n          const eyeScore = 1 - Math.min(gazeOffset * 3, 1);\n          if (lastNose.current) {\n            const dx = nose.x - lastNose.current.x;\n            const dy = nose.y - lastNose.current.y;\n            const movement = Math.sqrt(dx * dx + dy * dy);\n            headMovement.current += movement;\n          }\n          lastNose.current = nose;\n          const engagement = faceFrames.current / totalFrames.current;\n          const stability = Math.max(0, 1 - headMovement.current * 5);\n          const postureScore = eyeScore * 0.4 + engagement * 0.3 + stability * 0.3;\n          onScoreUpdate === null || onScoreUpdate === void 0 ? void 0 : onScoreUpdate(postureScore);\n        }\n      });\n      faceMeshRef.current = faceMesh;\n      intervalRef.current = setInterval(async () => {\n        if (videoRef.current.readyState >= 2) {\n          await faceMesh.send({\n            image: videoRef.current\n          });\n        }\n      }, 100);\n    }\n    init();\n    return () => clearInterval(intervalRef.current);\n  }, [videoRef, onScoreUpdate]);\n  return null;\n}\n_s(PostureAnalyzer, \"4S5Jic0uTz9cHVcjaryMclaSu9c=\");\n_c = PostureAnalyzer;\nvar _c;\n$RefreshReg$(_c, \"PostureAnalyzer\");","map":{"version":3,"names":["React","useEffect","useRef","PostureAnalyzer","videoRef","onScoreUpdate","_s","faceMeshRef","intervalRef","faceFrames","totalFrames","headMovement","lastNose","current","init","window","FaceMesh","script","document","createElement","src","async","body","appendChild","Promise","resolve","onload","Module","wasmBinaryFile","faceMesh","locateFile","file","setOptions","maxNumFaces","refineLandmarks","minDetectionConfidence","minTrackingConfidence","onResults","results","multiFaceLandmarks","landmarks","leftEye","rightEye","nose","eyeCenterX","x","gazeOffset","Math","abs","eyeScore","min","dx","dy","y","movement","sqrt","engagement","stability","max","postureScore","setInterval","readyState","send","image","clearInterval","_c","$RefreshReg$"],"sources":["/Users/siva/Desktop/AI-INTERVIEW/client/src/components/PostureAnalyzer.jsx"],"sourcesContent":["// client/src/components/PostureAnalyzer.jsx\n\nimport React, { useEffect, useRef } from \"react\";\n\nexport default function PostureAnalyzer({ videoRef, onScoreUpdate }) {\n  const faceMeshRef = useRef(null);\n  const intervalRef = useRef(null);\n\n  const faceFrames = useRef(0);\n  const totalFrames = useRef(0);\n  const headMovement = useRef(0);\n  const lastNose = useRef(null);\n\n  useEffect(() => {\n    if (!videoRef?.current) return;\n\n    async function init() {\n      if (!window.FaceMesh) {\n        const script = document.createElement(\"script\");\n        script.src =\n          \"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js\";\n        script.async = true;\n        document.body.appendChild(script);\n\n        await new Promise((resolve) => (script.onload = resolve));\n      }\n\n      // ⭐ FORCE NON-SIMD WASM (fix crash)\n      window.Module = {\n        wasmBinaryFile:\n          \"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh_solution_wasm_bin.wasm\",\n      };\n\n      const faceMesh = new window.FaceMesh({\n        locateFile: (file) =>\n          `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`,\n      });\n\n      faceMesh.setOptions({\n        maxNumFaces: 1,\n        refineLandmarks: true,\n        minDetectionConfidence: 0.5,\n        minTrackingConfidence: 0.5,\n      });\n\n      faceMesh.onResults((results) => {\n        totalFrames.current++;\n\n        if (results.multiFaceLandmarks) {\n          faceFrames.current++;\n\n          const landmarks = results.multiFaceLandmarks[0];\n          const leftEye = landmarks[33];\n          const rightEye = landmarks[263];\n          const nose = landmarks[1];\n\n          const eyeCenterX = (leftEye.x + rightEye.x) / 2;\n          const gazeOffset = Math.abs(nose.x - eyeCenterX);\n          const eyeScore = 1 - Math.min(gazeOffset * 3, 1);\n\n          if (lastNose.current) {\n            const dx = nose.x - lastNose.current.x;\n            const dy = nose.y - lastNose.current.y;\n            const movement = Math.sqrt(dx * dx + dy * dy);\n            headMovement.current += movement;\n          }\n          lastNose.current = nose;\n\n          const engagement =\n            faceFrames.current / totalFrames.current;\n\n          const stability = Math.max(\n            0,\n            1 - headMovement.current * 5\n          );\n\n          const postureScore =\n            eyeScore * 0.4 +\n            engagement * 0.3 +\n            stability * 0.3;\n\n          onScoreUpdate?.(postureScore);\n        }\n      });\n\n      faceMeshRef.current = faceMesh;\n\n      intervalRef.current = setInterval(async () => {\n        if (videoRef.current.readyState >= 2) {\n          await faceMesh.send({ image: videoRef.current });\n        }\n      }, 100);\n    }\n\n    init();\n\n    return () => clearInterval(intervalRef.current);\n  }, [videoRef, onScoreUpdate]);\n\n  return null;\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}