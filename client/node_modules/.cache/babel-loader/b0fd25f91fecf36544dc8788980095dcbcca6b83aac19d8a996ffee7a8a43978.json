{"ast":null,"code":"var _s = $RefreshSig$();\n// client/src/components/VoiceAnalyzer.jsx\n\nimport React, { useEffect, useRef } from \"react\";\nexport default function VoiceAnalyzer({\n  stream,\n  onVoiceScore\n}) {\n  _s();\n  const audioContextRef = useRef(null);\n  const analyserRef = useRef(null);\n  const dataArrayRef = useRef(null);\n  const lastEnergyRef = useRef(0);\n  const instabilityRef = useRef(0);\n  const silenceFramesRef = useRef(0);\n  const totalFramesRef = useRef(0);\n  const animationRef = useRef(null);\n  useEffect(() => {\n    if (!stream) return;\n\n    // Reset metrics for new recording\n    lastEnergyRef.current = 0;\n    instabilityRef.current = 0;\n    silenceFramesRef.current = 0;\n    totalFramesRef.current = 0;\n    const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n    const source = audioContext.createMediaStreamSource(stream);\n    const analyser = audioContext.createAnalyser();\n    analyser.fftSize = 2048;\n    source.connect(analyser);\n    const bufferLength = analyser.frequencyBinCount;\n    const dataArray = new Uint8Array(bufferLength);\n    audioContextRef.current = audioContext;\n    analyserRef.current = analyser;\n    dataArrayRef.current = dataArray;\n    function analyze() {\n      analyser.getByteFrequencyData(dataArray);\n\n      // ðŸ”¹ Compute average energy\n      let sum = 0;\n      for (let i = 0; i < bufferLength; i++) {\n        sum += dataArray[i];\n      }\n      const energy = sum / bufferLength;\n\n      // ðŸ”¹ Detect silence (pause proxy)\n      if (energy < 20) {\n        silenceFramesRef.current += 1;\n      }\n      totalFramesRef.current += 1;\n\n      // ðŸ”¹ Measure instability (voice tremor)\n      const diff = Math.abs(energy - lastEnergyRef.current);\n      instabilityRef.current += diff;\n      lastEnergyRef.current = energy;\n\n      // ðŸ”¹ Pause ratio\n      const pauseRatio = silenceFramesRef.current / totalFramesRef.current;\n\n      // ðŸ”¹ Tremor score\n      const tremorScore = Math.max(0, 1 - instabilityRef.current / 4000);\n\n      // ðŸ”¹ Final voice confidence\n      const voiceScore = tremorScore * 0.7 + (1 - pauseRatio) * 0.3;\n      if (onVoiceScore) {\n        onVoiceScore(voiceScore);\n      }\n      animationRef.current = requestAnimationFrame(analyze);\n    }\n    analyze();\n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n      if (audioContextRef.current) {\n        audioContextRef.current.close();\n      }\n    };\n  }, [stream, onVoiceScore]);\n  return null;\n}\n_s(VoiceAnalyzer, \"2KsMmqoOFZORi2EpeHfiKP5AUhg=\");\n_c = VoiceAnalyzer;\nvar _c;\n$RefreshReg$(_c, \"VoiceAnalyzer\");","map":{"version":3,"names":["React","useEffect","useRef","VoiceAnalyzer","stream","onVoiceScore","_s","audioContextRef","analyserRef","dataArrayRef","lastEnergyRef","instabilityRef","silenceFramesRef","totalFramesRef","animationRef","current","audioContext","window","AudioContext","webkitAudioContext","source","createMediaStreamSource","analyser","createAnalyser","fftSize","connect","bufferLength","frequencyBinCount","dataArray","Uint8Array","analyze","getByteFrequencyData","sum","i","energy","diff","Math","abs","pauseRatio","tremorScore","max","voiceScore","requestAnimationFrame","cancelAnimationFrame","close","_c","$RefreshReg$"],"sources":["/Users/siva/Desktop/AI-INTERVIEW/client/src/components/VoiceAnalyzer.jsx"],"sourcesContent":["// client/src/components/VoiceAnalyzer.jsx\n\nimport React, { useEffect, useRef } from \"react\";\n\nexport default function VoiceAnalyzer({ stream, onVoiceScore }) {\n  const audioContextRef = useRef(null);\n  const analyserRef = useRef(null);\n  const dataArrayRef = useRef(null);\n\n  const lastEnergyRef = useRef(0);\n  const instabilityRef = useRef(0);\n\n  const silenceFramesRef = useRef(0);\n  const totalFramesRef = useRef(0);\n\n  const animationRef = useRef(null);\n\n  useEffect(() => {\n    if (!stream) return;\n\n    // Reset metrics for new recording\n    lastEnergyRef.current = 0;\n    instabilityRef.current = 0;\n    silenceFramesRef.current = 0;\n    totalFramesRef.current = 0;\n\n    const audioContext =\n      new (window.AudioContext || window.webkitAudioContext)();\n\n    const source = audioContext.createMediaStreamSource(stream);\n    const analyser = audioContext.createAnalyser();\n\n    analyser.fftSize = 2048;\n    source.connect(analyser);\n\n    const bufferLength = analyser.frequencyBinCount;\n    const dataArray = new Uint8Array(bufferLength);\n\n    audioContextRef.current = audioContext;\n    analyserRef.current = analyser;\n    dataArrayRef.current = dataArray;\n\n    function analyze() {\n      analyser.getByteFrequencyData(dataArray);\n\n      // ðŸ”¹ Compute average energy\n      let sum = 0;\n      for (let i = 0; i < bufferLength; i++) {\n        sum += dataArray[i];\n      }\n\n      const energy = sum / bufferLength;\n\n      // ðŸ”¹ Detect silence (pause proxy)\n      if (energy < 20) {\n        silenceFramesRef.current += 1;\n      }\n\n      totalFramesRef.current += 1;\n\n      // ðŸ”¹ Measure instability (voice tremor)\n      const diff = Math.abs(energy - lastEnergyRef.current);\n      instabilityRef.current += diff;\n      lastEnergyRef.current = energy;\n\n      // ðŸ”¹ Pause ratio\n      const pauseRatio =\n        silenceFramesRef.current / totalFramesRef.current;\n\n      // ðŸ”¹ Tremor score\n      const tremorScore = Math.max(\n        0,\n        1 - instabilityRef.current / 4000\n      );\n\n      // ðŸ”¹ Final voice confidence\n      const voiceScore =\n        tremorScore * 0.7 + (1 - pauseRatio) * 0.3;\n\n      if (onVoiceScore) {\n        onVoiceScore(voiceScore);\n      }\n\n      animationRef.current = requestAnimationFrame(analyze);\n    }\n\n    analyze();\n\n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n\n      if (audioContextRef.current) {\n        audioContextRef.current.close();\n      }\n    };\n  }, [stream, onVoiceScore]);\n\n  return null;\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}